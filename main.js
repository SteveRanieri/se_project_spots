!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",saveButtonSelector:".modal__save-button",inactiveButtonClass:"modal__save-button_inactive",modalErrorClass:"modal__error",modalErrorVisibilityClass:"modal__error_visible",inputErrorClass:"modal__input_error"},t=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);o.classList.remove(r.modalErrorVisibilityClass),o.textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?(t.classList.add(r.inactiveButtonClass),t.disabled=!0):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)},o=(r,o,a=e)=>{o.forEach(e=>{t(r,e,a)})};(e=>{document.querySelectorAll(e.formSelector).forEach(o=>{((e,o)=>{const a=Array.from(e.querySelectorAll(o.inputSelector)),n=e.querySelector(o.saveButtonSelector);r(a,n,o),a.forEach(s=>{s.addEventListener("input",function(){((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{const a=e.querySelector(`#${t.id}-error`);a.classList.add(o.modalErrorVisibilityClass),a.textContent=r,t.classList.add(o.inputErrorClass)})(e,r,r.validationMessage,o)})(e,s,o),r(a,n,o)})})})(o,e)})})(e);const a=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}postNewCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editAvatarImage({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}toggleLike({id:e,isLiked:t}){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"9abc2833-aa11-4aeb-bfc0-0e776ac373ec","Content-Type":"application/json"}}),n=document.querySelector(".cards__list"),s=document.querySelector("#card-template"),l=document.querySelector(".profile__edit-button"),c=document.querySelector("#edit-profile-modal"),i=c.querySelector(".modal__close-button"),d=document.querySelector(".profile__name"),u=document.querySelector(".profile__paragraph"),m=c.querySelector(".modal__form"),_=c.querySelector("#profile-name"),h=c.querySelector("#profile-description"),f=document.querySelector(".profile__avatar"),v=document.querySelector(".profile__avatar-button"),y=document.querySelector("#avatar-modal"),p=y.querySelector(".modal__close-button"),b=y.querySelector(".modal__form"),S=y.querySelector("#profile-avatar-input"),q=document.querySelector(".profile__post-button"),E=document.querySelector("#new-post-modal"),g=E.querySelector(".modal__close-button"),k=E.querySelector(".modal__form"),C=E.querySelector("#post-image"),L=E.querySelector("#post-caption"),$=document.querySelector("#preview-modal"),j=$.querySelector(".modal__image-caption"),U=$.querySelector(".modal__image"),x=$.querySelector(".modal__close-button"),P=document.querySelector("#delete-modal"),I=P.querySelectorAll(".js-modal-close"),A=P.querySelector(".modal__delete-button");let T,O;function w(e){const t=s.content.cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like"),l=t.querySelector(".card__delete");return o.src=e.link,o.alt=e.name,r.textContent=e.name,e.isLiked&&n.classList.add("card__like_liked"),n.addEventListener("click",t=>{!function(e,t){const r=e.target,o=r.classList.contains("card__like_liked");a.toggleLike({id:t,isLiked:o}).then(()=>{r.classList.toggle("card__like_liked")}).catch(console.error)}(t,e._id)}),l.addEventListener("click",t=>{!function(e,t){T=e,O=t._id,D(P)}(t.target.closest(".card"),e)}),o.addEventListener("click",function(){j.textContent=e.name,U.src=e.link,U.alt=e.name,D($)}),t}function D(e){e.classList.add("modal_is-opened"),e.focus()}function N(e){e.classList.remove("modal_is-opened")}a.getAppInfo().then(([e,t])=>{e.forEach(e=>{const t=w(e);n.prepend(t)});const{about:r,avatar:o,name:a}=t;f.src=o,d.textContent=a,u.textContent=r,console.log("USer Info:",t),console.log("Cards:",e)}).catch(console.error),A.addEventListener("click",function(){J(!0,A,"Deleting..."),a.deleteCard(O).then(()=>{T.remove(),N(P)}).catch(console.error).finally(()=>{J(!1,A)})}),[{button:l,modal:c,onOpen:()=>{_.value=d.textContent,h.value=u.textContent}},{button:v,modal:y,onOpen:()=>o(b,[S])},{button:q,modal:E,onOpen:()=>o(k,[C,L])}].forEach(({button:e,modal:t,onOpen:r})=>{e.addEventListener("click",()=>{D(t),r&&r()})}),[{button:i,modal:c},{button:p,modal:y},{button:g,modal:E},{button:x,modal:$}].forEach(({button:e,modal:t})=>{e.addEventListener("click",()=>N(t))}),I.forEach(e=>{e.addEventListener("click",()=>N(P))}),document.addEventListener("keydown",e=>{if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&N(e)}});const B=e=>{e.addEventListener("click",function(t){t.target===e&&N(e)})};function J(e,t,r="Saving..."){e?(t.dataset.originalText=t.textContent,t.textContent=r,t.disabled=!0):(t.textContent=t.dataset.originalText,t.disabled=!1)}B(c),B(E),B($),B(P),B(y),m.addEventListener("submit",function(e){const t=e.target.querySelector(".modal__save-button");e.preventDefault(),J(!0,t),a.editUserInfo({name:_.value,about:h.value}).then(e=>{d.textContent=e.name,u.textContent=e.about,N(c)}).catch(console.error).finally(()=>{J(!1,t),e.target.reset()}),o(m,[_,h])}),k.addEventListener("submit",function(e){const t=e.target.querySelector(".modal__save-button");e.preventDefault(),J(!0,t),a.postNewCard({name:L.value,link:C.value}).then(e=>{const t=w(e);n.prepend(t),N(E)}).catch(console.error).finally(()=>{J(!1,t),e.target.reset()})}),b.addEventListener("submit",function(e){e.preventDefault();const t=e.target.querySelector(".modal__save-button");J(!0,t),a.editAvatarImage({avatar:S.value}).then(e=>{f.src=e.avatar,N(y)}).catch(console.error).finally(()=>{J(!1,t),e.target.reset()})})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoieUJBQUEsTUFBTUEsRUFBUyxDQUNiQyxhQUFjLGVBQ2RDLGNBQWUsZ0JBQ2ZDLG1CQUFvQixzQkFDcEJDLG9CQUFxQiw4QkFDckJDLGdCQUFpQixlQUNqQkMsMEJBQTJCLHVCQUMzQkMsZ0JBQWlCLHNCQVViQyxFQUFpQkEsQ0FBQ0MsRUFBYUMsRUFBY1YsS0FDakQsTUFBTVcsRUFBZUYsRUFBWUcsY0FBYyxJQUFJRixFQUFhRyxZQUNoRUYsRUFBYUcsVUFBVUMsT0FBT2YsRUFBT00sMkJBQ3JDSyxFQUFhSyxZQUFjLEdBQzNCTixFQUFhSSxVQUFVQyxPQUFPZixFQUFPTyxrQkFzQmpDVSxFQUFvQkEsQ0FBQ0MsRUFBV0MsRUFBZW5CLEtBTjVCa0IsSUFDaEJBLEVBQVVFLEtBQU1WLElBQ2JBLEVBQWFXLFNBQVNDLE9BSzVCQyxDQUFnQkwsSUFDbEJDLEVBQWNMLFVBQVVVLElBQUl4QixFQUFPSSxxQkFDbkNlLEVBQWNNLFVBQVcsSUFFekJOLEVBQWNMLFVBQVVDLE9BQU9mLEVBQU9JLHFCQUN0Q2UsRUFBY00sVUFBVyxJQUl2QkMsRUFBa0JBLENBQUNqQixFQUFhUyxFQUFXUyxFQUFNM0IsS0FDckRrQixFQUFVVSxRQUFTQyxJQUNqQnJCLEVBQWVDLEVBQWFvQixFQUFPRixNQWtCYjNCLEtBQ1A4QixTQUFTQyxpQkFBaUIvQixFQUFPQyxjQUN6QzJCLFFBQVNuQixJQWhCTXVCLEVBQUN2QixFQUFhVCxLQUN0QyxNQUFNa0IsRUFBWWUsTUFBTUMsS0FDdEJ6QixFQUFZc0IsaUJBQWlCL0IsRUFBT0UsZ0JBRWhDaUIsRUFBZ0JWLEVBQVlHLGNBQWNaLEVBQU9HLG9CQUN2RGMsRUFBa0JDLEVBQVdDLEVBQWVuQixHQUM1Q2tCLEVBQVVVLFFBQVNsQixJQUNqQkEsRUFBYXlCLGlCQUFpQixRQUFTLFdBMUNoQkMsRUFBQzNCLEVBQWFDLEVBQWNWLEtBQ2hEVSxFQUFhVyxTQUFTQyxNQVF6QmQsRUFBZUMsRUFBYUMsRUFBY1YsR0F2QnZCcUMsRUFBQzVCLEVBQWFDLEVBQWM0QixFQUFjdEMsS0FDL0QsTUFBTVcsRUFBZUYsRUFBWUcsY0FBYyxJQUFJRixFQUFhRyxZQUNoRUYsRUFBYUcsVUFBVVUsSUFBSXhCLEVBQU9NLDJCQUNsQ0ssRUFBYUssWUFBY3NCLEVBQzNCNUIsRUFBYUksVUFBVVUsSUFBSXhCLEVBQU9PLGtCQVloQzhCLENBQ0U1QixFQUNBQyxFQUNBQSxFQUFhNkIsa0JBQ2J2QyxJQXFDQW9DLENBQW1CM0IsRUFBYUMsRUFBY1YsR0FDOUNpQixFQUFrQkMsRUFBV0MsRUFBZW5CLEVBQzlDLE1BT0FnQyxDQUFrQnZCLEVBQWFULE1DdEVuQ3dDLENBQWlCeEMsR0FPakIsTUFBTXlDLEVBQU0sSUNiRyxNQUNiQyxXQUFBQSxFQUFZLFFBQUVDLEVBQU8sUUFBRUMsSUFDckJDLEtBQUtDLFNBQVdILEVBQ2hCRSxLQUFLRSxTQUFXSCxDQUNsQixDQUVBSSxVQUFBQSxHQUNFLE9BQU9DLFFBQVFDLElBQUksQ0FBQ0wsS0FBS00sa0JBQW1CTixLQUFLTyxlQUNuRCxDQUVBRCxlQUFBQSxHQUNFLE9BQU9FLE1BQU0sR0FBR1IsS0FBS0MsaUJBQWtCLENBQ3JDRixRQUFTQyxLQUFLRSxXQUNiTyxLQUFNQyxHQUNIQSxFQUFJQyxHQUNDRCxFQUFJRSxPQUdOUixRQUFRUyxPQUFPLFVBQVVILEVBQUlJLFVBRXhDLENBRUFDLFdBQUFBLEVBQVksS0FBRUMsRUFBSSxLQUFFQyxJQUNsQixPQUFPVCxNQUFNLEdBQUdSLEtBQUtDLGlCQUFrQixDQUNyQ2lCLE9BQVEsT0FDUm5CLFFBQVNDLEtBQUtFLFNBRWRpQixLQUFNQyxLQUFLQyxVQUFVLENBQ25CTCxPQUNBQyxXQUVEUixLQUFNQyxHQUNIQSxFQUFJQyxHQUNDRCxFQUFJRSxPQUdOUixRQUFRUyxPQUFPLFVBQVVILEVBQUlJLFVBRXhDLENBRUFRLFVBQUFBLENBQVd0RCxHQUNULE9BQU93QyxNQUFNLEdBQUdSLEtBQUtDLGtCQUFrQmpDLElBQU0sQ0FDM0NrRCxPQUFRLFNBQ1JuQixRQUFTQyxLQUFLRSxXQUNiTyxLQUFNQyxHQUNIQSxFQUFJQyxHQUNDRCxFQUFJRSxPQUdOUixRQUFRUyxPQUFPLFVBQVVILEVBQUlJLFVBRXhDLENBRUFQLFdBQUFBLEdBQ0UsT0FBT0MsTUFBTSxHQUFHUixLQUFLQyxvQkFBcUIsQ0FDeENGLFFBQVNDLEtBQUtFLFdBQ2JPLEtBQU1DLEdBQ0hBLEVBQUlDLEdBQ0NELEVBQUlFLE9BR05SLFFBQVFTLE9BQU8sVUFBVUgsRUFBSUksVUFFeEMsQ0FFQVMsWUFBQUEsRUFBYSxLQUFFUCxFQUFJLE1BQUVRLElBQ25CLE9BQU9oQixNQUFNLEdBQUdSLEtBQUtDLG9CQUFxQixDQUN4Q2lCLE9BQVEsUUFDUm5CLFFBQVNDLEtBQUtFLFNBRWRpQixLQUFNQyxLQUFLQyxVQUFVLENBQ25CTCxPQUNBUSxZQUVEZixLQUFNQyxHQUNIQSxFQUFJQyxHQUNDRCxFQUFJRSxPQUdOUixRQUFRUyxPQUFPLFVBQVVILEVBQUlJLFVBRXhDLENBRUFXLGVBQUFBLEVBQWdCLE9BQUVDLElBQ2hCLE9BQU9sQixNQUFNLEdBQUdSLEtBQUtDLDJCQUE0QixDQUMvQ2lCLE9BQVEsUUFDUm5CLFFBQVNDLEtBQUtFLFNBRWRpQixLQUFNQyxLQUFLQyxVQUFVLENBQ25CSyxhQUVEakIsS0FBTUMsR0FDSEEsRUFBSUMsR0FDQ0QsRUFBSUUsT0FHTlIsUUFBUVMsT0FBTyxVQUFVSCxFQUFJSSxVQUV4QyxDQUVBYSxVQUFBQSxFQUFXLEdBQUUzRCxFQUFFLFFBQUU0RCxJQUNmLE9BQU9wQixNQUFNLEdBQUdSLEtBQUtDLGtCQUFrQmpDLFVBQVksQ0FDakRrRCxPQUFRVSxFQUFVLFNBQVcsTUFDN0I3QixRQUFTQyxLQUFLRSxXQUNiTyxLQUFNQyxHQUNIQSxFQUFJQyxHQUNDRCxFQUFJRSxPQUdOUixRQUFRUyxPQUFPLFVBQVVILEVBQUlJLFVBRXhDLEdEbEdrQixDQUNsQmhCLFFBQVMsa0RBQ1RDLFFBQVMsQ0FDUDhCLGNBQWUsdUNBQ2YsZUFBZ0Isc0JBS2RDLEVBQVk3QyxTQUFTbEIsY0FBYyxnQkFDbkNnRSxFQUFlOUMsU0FBU2xCLGNBQWMsa0JBR3RDaUUsRUFBaUIvQyxTQUFTbEIsY0FBYyx5QkFDeENrRSxFQUFtQmhELFNBQVNsQixjQUFjLHVCQUMxQ21FLEVBQW9CRCxFQUFpQmxFLGNBQ3pDLHdCQUlJb0UsRUFBY2xELFNBQVNsQixjQUFjLGtCQUNyQ3FFLEVBQXFCbkQsU0FBU2xCLGNBQWMsdUJBQzVDc0UsRUFBa0JKLEVBQWlCbEUsY0FBYyxnQkFDakR1RSxFQUF1QkwsRUFBaUJsRSxjQUFjLGlCQUN0RHdFLEVBQThCTixFQUFpQmxFLGNBQ25ELHdCQUVJeUUsRUFBZ0J2RCxTQUFTbEIsY0FBYyxvQkFHdkMwRSxFQUFtQnhELFNBQVNsQixjQUFjLDJCQUMxQzJFLEVBQWN6RCxTQUFTbEIsY0FBYyxpQkFDckM0RSxFQUFtQkQsRUFBWTNFLGNBQWMsd0JBRzdDNkUsRUFBaUJGLEVBQVkzRSxjQUFjLGdCQUMzQzhFLEVBQWlCSCxFQUFZM0UsY0FBYyx5QkFHM0MrRSxFQUFhN0QsU0FBU2xCLGNBQWMseUJBQ3BDZ0YsRUFBZTlELFNBQVNsQixjQUFjLG1CQUN0Q2lGLEVBQWlCRCxFQUFhaEYsY0FBYyx3QkFHNUNrRixFQUFlRixFQUFhaEYsY0FBYyxnQkFDMUNtRixFQUFvQkgsRUFBYWhGLGNBQWMsZUFDL0NvRixFQUF1QkosRUFBYWhGLGNBQWMsaUJBR2xEcUYsRUFBZW5FLFNBQVNsQixjQUFjLGtCQUN0Q3NGLEVBQW1CRCxFQUFhckYsY0FBYyx5QkFDOUN1RixFQUFvQkYsRUFBYXJGLGNBQWMsaUJBQy9Dd0YsRUFBb0JILEVBQWFyRixjQUFjLHdCQUcvQ3lGLEVBQWN2RSxTQUFTbEIsY0FBYyxpQkFDckMwRixFQUFtQkQsRUFBWXRFLGlCQUFpQixtQkFDaER3RSxFQUFlRixFQUFZekYsY0FBYyx5QkFxQi9DLElBQUk0RixFQUNBQyxFQUNKLFNBQVNDLEVBQWVDLEdBQ3RCLE1BQU1DLEVBQWNoQyxFQUFhaUMsUUFBUUMsV0FBVSxHQUM3Q0MsRUFBV0gsRUFBWWhHLGNBQWMsZ0JBQ3JDb0csRUFBWUosRUFBWWhHLGNBQWMsZ0JBQ3RDcUcsRUFBaUJMLEVBQVloRyxjQUFjLGVBQzNDc0csRUFBbUJOLEVBQVloRyxjQUFjLGlCQXFDbkQsT0FuQ0FvRyxFQUFVRyxJQUFNUixFQUFLN0MsS0FDckJrRCxFQUFVSSxJQUFNVCxFQUFLOUMsS0FDckJrRCxFQUFTL0YsWUFBYzJGLEVBQUs5QyxLQUV4QjhDLEVBQUtsQyxTQUNQd0MsRUFBZW5HLFVBQVVVLElBQUksb0JBRy9CeUYsRUFBZTlFLGlCQUFpQixRQUFVa0YsS0FJMUMsU0FBb0JBLEVBQUt4RyxHQUN2QixNQUFNeUcsRUFBYUQsRUFBSUUsT0FDakI5QyxFQUFVNkMsRUFBV3hHLFVBQVUwRyxTQUFTLG9CQUU5Qy9FLEVBQ0crQixXQUFXLENBQUUzRCxLQUFJNEQsWUFDakJuQixLQUFLLEtBQ0pnRSxFQUFXeEcsVUFBVTJHLE9BQU8sc0JBRTdCQyxNQUFNQyxRQUFRQyxNQUNuQixDQWJFQyxDQUFXUixFQUFLVixFQUFLbUIsT0FldkJaLEVBQWlCL0UsaUJBQWlCLFFBQVVrRixLQWM5QyxTQUEwQlQsRUFBYUQsR0FDckNILEVBQWVJLEVBQ2ZILEVBQWlCRSxFQUFLbUIsSUFDdEJDLEVBQVUxQixFQUNaLENBakJJMkIsQ0FBaUJYLEVBQUlFLE9BQU9VLFFBQVEsU0FBVXRCLEtBR2hESyxFQUFVN0UsaUJBQWlCLFFBQVMsV0FDbEMrRCxFQUFpQmxGLFlBQWMyRixFQUFLOUMsS0FDcENzQyxFQUFrQmdCLElBQU1SLEVBQUs3QyxLQUM3QnFDLEVBQWtCaUIsSUFBTVQsRUFBSzlDLEtBQzdCa0UsRUFBVTlCLEVBQ1osR0FFT1csQ0FDVCxDQTJCQSxTQUFTbUIsRUFBVUcsR0FDakJBLEVBQU1wSCxVQUFVVSxJQUFJLG1CQUNwQjBHLEVBQU1DLE9BQ1IsQ0FDQSxTQUFTQyxFQUFXRixHQUNsQkEsRUFBTXBILFVBQVVDLE9BQU8sa0JBQ3pCLENBaEdBMEIsRUFDR08sYUFDQU0sS0FBSyxFQUFFK0UsRUFBT0MsTUFDYkQsRUFBTXpHLFFBQVMyRyxJQUNiLE1BQU0zQixFQUFjRixFQUFlNkIsR0FDbkM1RCxFQUFVNkQsUUFBUTVCLEtBR3BCLE1BQU0sTUFBRXZDLEVBQUssT0FBRUUsRUFBTSxLQUFFVixHQUFTeUUsRUFDaENqRCxFQUFjOEIsSUFBTTVDLEVBQ3BCUyxFQUFZaEUsWUFBYzZDLEVBQzFCb0IsRUFBbUJqRSxZQUFjcUQsRUFDakNzRCxRQUFRYyxJQUFJLGFBQWNILEdBQzFCWCxRQUFRYyxJQUFJLFNBQVVKLEtBRXZCWCxNQUFNQyxRQUFRQyxPQXdFakJyQixFQUFhcEUsaUJBQWlCLFFBaEI5QixXQUNFdUcsR0FBYyxFQUFNbkMsRUFBYyxlQUVsQzlELEVBQ0cwQixXQUFXc0MsR0FDWG5ELEtBQUssS0FDSmtELEVBQWF6RixTQUVicUgsRUFBVy9CLEtBRVpxQixNQUFNQyxRQUFRQyxPQUNkZSxRQUFRLEtBQ1BELEdBQWMsRUFBT25DLElBRTNCLEdBY3lCLENBQ3ZCLENBQ0VxQyxPQUFRL0QsRUFDUnFELE1BQU9wRCxFQUNQK0QsT0FBUUEsS0FDTjFELEVBQXFCMkQsTUFBUTlELEVBQVloRSxZQUN6Q29FLEVBQTRCMEQsTUFBUTdELEVBQW1CakUsY0FHM0QsQ0FDRTRILE9BQVF0RCxFQUNSNEMsTUFBTzNDLEVBQ1BzRCxPQUFRQSxJQUFNbkgsRUFBZ0IrRCxFQUFnQixDQUFDQyxLQUVqRCxDQUNFa0QsT0FBUWpELEVBQ1J1QyxNQUFPdEMsRUFDUGlELE9BQVFBLElBQ05uSCxFQUFnQm9FLEVBQWMsQ0FBQ0MsRUFBbUJDLE1BSXZDcEUsUUFBUSxFQUFHZ0gsU0FBUVYsUUFBT1csYUFDekNELEVBQU96RyxpQkFBaUIsUUFBUyxLQUMvQjRGLEVBQVVHLEdBQ05XLEdBQVFBLFFBS1UsQ0FDeEIsQ0FBRUQsT0FBUTdELEVBQW1CbUQsTUFBT3BELEdBQ3BDLENBQUU4RCxPQUFRcEQsRUFBa0IwQyxNQUFPM0MsR0FDbkMsQ0FBRXFELE9BQVEvQyxFQUFnQnFDLE1BQU90QyxHQUNqQyxDQUFFZ0QsT0FBUXhDLEVBQW1COEIsTUFBT2pDLElBR3BCckUsUUFBUSxFQUFHZ0gsU0FBUVYsWUFDbkNVLEVBQU96RyxpQkFBaUIsUUFBUyxJQUFNaUcsRUFBV0YsTUFJcEQ1QixFQUFpQjFFLFFBQVNnSCxJQUN4QkEsRUFBT3pHLGlCQUFpQixRQUFTLElBQU1pRyxFQUFXL0IsTUFJcER2RSxTQUFTSyxpQkFBaUIsVUFBWWtGLElBQ3BDLEdBQWdCLFdBQVpBLEVBQUkwQixJQUFrQixDQUN4QixNQUFNaEIsRUFBWWpHLFNBQVNsQixjQUFjLG9CQUNyQ21ILEdBQ0ZLLEVBQVdMLEVBRWYsSUFHRixNQUFNaUIsRUFBcUJDLElBQ3pCQSxFQUFXOUcsaUJBQWlCLFFBQVMsU0FBVWtGLEdBQ3pDQSxFQUFJRSxTQUFXMEIsR0FDakJiLEVBQVdhLEVBRWYsSUFVRixTQUFTUCxFQUFjUSxFQUFXTixFQUFRTyxFQUFjLGFBQ2xERCxHQUNGTixFQUFPUSxRQUFRQyxhQUFlVCxFQUFPNUgsWUFDckM0SCxFQUFPNUgsWUFBY21JLEVBQ3JCUCxFQUFPbkgsVUFBVyxJQUVsQm1ILEVBQU81SCxZQUFjNEgsRUFBT1EsUUFBUUMsYUFDcENULEVBQU9uSCxVQUFXLEVBRXRCLENBaEJBdUgsRUFBa0JsRSxHQUNsQmtFLEVBQWtCcEQsR0FDbEJvRCxFQUFrQi9DLEdBQ2xCK0MsRUFBa0IzQyxHQUNsQjJDLEVBQWtCekQsR0EyQ2xCTCxFQUFnQi9DLGlCQUFpQixTQTVCakMsU0FBaUNrRixHQUMvQixNQUFNaUMsRUFBZWpDLEVBQUlFLE9BQU8zRyxjQUFjLHVCQUM5Q3lHLEVBQUlrQyxpQkFFSmIsR0FBYyxFQUFNWSxHQUVwQjdHLEVBQ0cyQixhQUFhLENBQ1pQLEtBQU1zQixFQUFxQjJELE1BQzNCekUsTUFBT2UsRUFBNEIwRCxRQUVwQ3hGLEtBQU1xRCxJQUNMM0IsRUFBWWhFLFlBQWMyRixFQUFLOUMsS0FDL0JvQixFQUFtQmpFLFlBQWMyRixFQUFLdEMsTUFFdEMrRCxFQUFXdEQsS0FFWjRDLE1BQU1DLFFBQVFDLE9BQ2RlLFFBQVEsS0FDUEQsR0FBYyxFQUFPWSxHQUNyQmpDLEVBQUlFLE9BQU9pQyxVQUVmOUgsRUFBZ0J3RCxFQUFpQixDQUMvQkMsRUFDQUMsR0FFSixHQTRCQVUsRUFBYTNELGlCQUFpQixTQXZCOUIsU0FBOEJrRixHQUM1QixNQUFNaUMsRUFBZWpDLEVBQUlFLE9BQU8zRyxjQUFjLHVCQUM5Q3lHLEVBQUlrQyxpQkFFSmIsR0FBYyxFQUFNWSxHQUVwQjdHLEVBQ0dtQixZQUFZLENBQ1hDLEtBQU1tQyxFQUFxQjhDLE1BQzNCaEYsS0FBTWlDLEVBQWtCK0MsUUFFekJ4RixLQUFNaUYsSUFDTCxNQUFNM0IsRUFBY0YsRUFBZTZCLEdBQ25DNUQsRUFBVTZELFFBQVE1QixHQUNsQndCLEVBQVd4QyxLQUVaOEIsTUFBTUMsUUFBUUMsT0FDZGUsUUFBUSxLQUNQRCxHQUFjLEVBQU9ZLEdBQ3JCakMsRUFBSUUsT0FBT2lDLFNBRWpCLEdBeUJBL0QsRUFBZXRELGlCQUFpQixTQXBCaEMsU0FBNEJrRixHQUMxQkEsRUFBSWtDLGlCQUNKLE1BQU1ELEVBQWVqQyxFQUFJRSxPQUFPM0csY0FBYyx1QkFDOUM4SCxHQUFjLEVBQU1ZLEdBRXBCN0csRUFDRzZCLGdCQUFnQixDQUNmQyxPQUFRbUIsRUFBZW9ELFFBRXhCeEYsS0FBTXFELElBQ0x0QixFQUFjOEIsSUFBTVIsRUFBS3BDLE9BQ3pCNkQsRUFBVzdDLEtBRVptQyxNQUFNQyxRQUFRQyxPQUNkZSxRQUFRLEtBQ1BELEdBQWMsRUFBT1ksR0FDckJqQyxFQUFJRSxPQUFPaUMsU0FFakIsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjb25maWcgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHNhdmVCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3NhdmUtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3NhdmUtYnV0dG9uX2luYWN0aXZlXCIsXG4gIG1vZGFsRXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JcIixcbiAgbW9kYWxFcnJvclZpc2liaWxpdHlDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X2Vycm9yXCIsXG59O1xuXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5tb2RhbEVycm9yVmlzaWJpbGl0eUNsYXNzKTtcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5tb2RhbEVycm9yVmlzaWJpbGl0eUNsYXNzKTtcbiAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoXG4gICAgICBmb3JtRWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcbiAgICAgIGNvbmZpZ1xuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgfVxufTtcblxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICB9KTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gIH1cbn07XG5cbmNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCwgaW5wdXRMaXN0LCBjZmcgPSBjb25maWcpID0+IHtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBjZmcpO1xuICB9KTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShcbiAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxuICApO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc2F2ZUJ1dHRvblNlbGVjdG9yKTtcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIGNvbmZpZyk7XG4gIH0pO1xufTtcblxuZXhwb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgcmVzZXRWYWxpZGF0aW9uLCBjb25maWcgfTtcbiIsIi8vVmFsaWRhdGlvbiBJbXBvcnQgYW5kIGNhbGxcbmltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHJlc2V0VmFsaWRhdGlvbixcbiAgY29uZmlnLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5lbmFibGVWYWxpZGF0aW9uKGNvbmZpZyk7XG5cbi8vLS0tLVZhcmlhYmxlcy0tLS1cbi8vQ2FyZCBpbWFnZSBhcnJheVxuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3NjcmlwdHMvdXRpbHMvQXBpLmpzXCI7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjlhYmMyODMzLWFhMTEtNGFlYi1iZmMwLTBlNzc2YWMzNzNlY1wiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbi8vQ2FyZCBmdW5jdGlvbmFsaXR5XG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpO1xuXG4vL1Byb2ZpbGUgTW9kYWxcbmNvbnN0IGVkaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGNsb3NlUHJvZmlsZU1vZGFsID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCIsXG4pO1xuXG4vL1Byb2ZpbGUgTW9kYWwgRWRpdFxuY29uc3QgcHJvZmlsZU5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX3BhcmFncmFwaFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlRm9ybSA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTmFtZUlucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZVwiKTtcbmNvbnN0IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvblwiLFxuKTtcbmNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcblxuLy9BdmF0YXIgTW9kYWxcbmNvbnN0IGVkaXRBdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idXR0b25cIik7XG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLW1vZGFsXCIpO1xuY29uc3QgY2xvc2VBdmF0YXJNb2RhbCA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ1dHRvblwiKTtcblxuLy9BdmF0YXIgTW9kYWwgRWRpdFxuY29uc3QgZWRpdEF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdEF2YXRhckxpbmsgPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtYXZhdGFyLWlucHV0XCIpO1xuXG4vL05ldyBQb3N0IE1vZGFsXG5jb25zdCBuZXdQb3N0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19wb3N0LWJ1dHRvblwiKTtcbmNvbnN0IG5ld1Bvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIik7XG5jb25zdCBjbG9zZVBvc3RNb2RhbCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIik7XG5cbi8vIE5ldyBQb3N0IE1vZGFsIEVkaXRcbmNvbnN0IGVkaXRQb3N0Rm9ybSA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdFBvc3RQaG90b0xpbmsgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNwb3N0LWltYWdlXCIpO1xuY29uc3QgZWRpdFBvc3RDYXB0aW9uSW5wdXQgPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIiNwb3N0LWNhcHRpb25cIik7XG5cbi8vUHJldmlldyBNb2RhbFxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld01vZGFsVGV4dCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZS1jYXB0aW9uXCIpO1xuY29uc3QgcHJldmlld01vZGFsSW1hZ2UgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG5jb25zdCBjbG9zZVByZXZpZXdNb2RhbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIik7XG5cbi8vRGVsZXRlIE1vZGFsXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xuY29uc3QgY2xvc2VEZWxldGVNb2RhbCA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuanMtbW9kYWwtY2xvc2VcIik7XG5jb25zdCBkZWxldGVCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19kZWxldGUtYnV0dG9uXCIpO1xuXG4vL0luaXRpYWxpemF0aW9uXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzLCB1c2VySW5mb10pID0+IHtcbiAgICBjYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGNhcmQpO1xuICAgICAgY2FyZHNMaXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgeyBhYm91dCwgYXZhdGFyLCBuYW1lIH0gPSB1c2VySW5mbztcbiAgICBwcm9maWxlQXZhdGFyLnNyYyA9IGF2YXRhcjtcbiAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gYWJvdXQ7XG4gICAgY29uc29sZS5sb2coXCJVU2VyIEluZm86XCIsIHVzZXJJbmZvKTtcbiAgICBjb25zb2xlLmxvZyhcIkNhcmRzOlwiLCBjYXJkcyk7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuLy9DYXJkc1xubGV0IHNlbGVjdGVkQ2FyZDtcbmxldCBzZWxlY3RlZENhcmRJZDtcbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY29udGVudC5jbG9uZU5vZGUodHJ1ZSk7XG4gIGNvbnN0IGNhcmROYW1lID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZEltYWdlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2VcIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZVwiKTtcblxuICBjYXJkSW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2UuYWx0ID0gZGF0YS5uYW1lO1xuICBjYXJkTmFtZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcblxuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2VfbGlrZWRcIik7XG4gIH1cblxuICBjYXJkTGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgIGhhbmRsZUxpa2UoZXZ0LCBkYXRhLl9pZCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIGhhbmRsZUxpa2UoZXZ0LCBpZCkge1xuICAgIGNvbnN0IGxpa2VCdXR0b24gPSBldnQudGFyZ2V0O1xuICAgIGNvbnN0IGlzTGlrZWQgPSBsaWtlQnV0dG9uLmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2VfbGlrZWRcIik7XG5cbiAgICBhcGlcbiAgICAgIC50b2dnbGVMaWtlKHsgaWQsIGlzTGlrZWQgfSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZV9saWtlZFwiKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gIH1cblxuICBjYXJkRGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgaGFuZGxlRGVsZXRlQ2FyZChldnQudGFyZ2V0LmNsb3Nlc3QoXCIuY2FyZFwiKSwgZGF0YSk7XG4gIH0pO1xuXG4gIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIHByZXZpZXdNb2RhbFRleHQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld01vZGFsSW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdNb2RhbEltYWdlLmFsdCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBkYXRhKSB7XG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICBzZWxlY3RlZENhcmRJZCA9IGRhdGEuX2lkO1xuICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoKSB7XG4gIHJlbmRlckxvYWRpbmcodHJ1ZSwgZGVsZXRlQnV0dG9uLCBcIkRlbGV0aW5nLi4uXCIpO1xuXG4gIGFwaVxuICAgIC5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcblxuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBkZWxldGVCdXR0b24pO1xuICAgIH0pO1xufVxuXG5kZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG5cbi8vT3BlbmluZyBhbmQgY2xvc2luZyBNb2RhbHNcbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBtb2RhbC5mb2N1cygpO1xufVxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xufVxuXG4vLyBNb2RhbCBvcGVuIGJ1dHRvbnNcbmNvbnN0IG1vZGFsT3BlbkJ1dHRvbnMgPSBbXG4gIHtcbiAgICBidXR0b246IGVkaXRQcm9maWxlQnRuLFxuICAgIG1vZGFsOiBlZGl0UHJvZmlsZU1vZGFsLFxuICAgIG9uT3BlbjogKCkgPT4ge1xuICAgICAgZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbiAgICAgIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcbiAgICB9LFxuICB9LFxuICB7XG4gICAgYnV0dG9uOiBlZGl0QXZhdGFyQnV0dG9uLFxuICAgIG1vZGFsOiBhdmF0YXJNb2RhbCxcbiAgICBvbk9wZW46ICgpID0+IHJlc2V0VmFsaWRhdGlvbihlZGl0QXZhdGFyRm9ybSwgW2VkaXRBdmF0YXJMaW5rXSksXG4gIH0sXG4gIHtcbiAgICBidXR0b246IG5ld1Bvc3RCdG4sXG4gICAgbW9kYWw6IG5ld1Bvc3RNb2RhbCxcbiAgICBvbk9wZW46ICgpID0+XG4gICAgICByZXNldFZhbGlkYXRpb24oZWRpdFBvc3RGb3JtLCBbZWRpdFBvc3RQaG90b0xpbmssIGVkaXRQb3N0Q2FwdGlvbklucHV0XSksXG4gIH0sXG5dO1xuXG5tb2RhbE9wZW5CdXR0b25zLmZvckVhY2goKHsgYnV0dG9uLCBtb2RhbCwgb25PcGVuIH0pID0+IHtcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgb3Blbk1vZGFsKG1vZGFsKTtcbiAgICBpZiAob25PcGVuKSBvbk9wZW4oKTtcbiAgfSk7XG59KTtcblxuLy8gTW9kYWwgY2xvc2UgYnV0dG9uc1xuY29uc3QgbW9kYWxDbG9zZUJ1dHRvbnMgPSBbXG4gIHsgYnV0dG9uOiBjbG9zZVByb2ZpbGVNb2RhbCwgbW9kYWw6IGVkaXRQcm9maWxlTW9kYWwgfSxcbiAgeyBidXR0b246IGNsb3NlQXZhdGFyTW9kYWwsIG1vZGFsOiBhdmF0YXJNb2RhbCB9LFxuICB7IGJ1dHRvbjogY2xvc2VQb3N0TW9kYWwsIG1vZGFsOiBuZXdQb3N0TW9kYWwgfSxcbiAgeyBidXR0b246IGNsb3NlUHJldmlld01vZGFsLCBtb2RhbDogcHJldmlld01vZGFsIH0sXG5dO1xuXG5tb2RhbENsb3NlQnV0dG9ucy5mb3JFYWNoKCh7IGJ1dHRvbiwgbW9kYWwgfSkgPT4ge1xuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwobW9kYWwpKTtcbn0pO1xuXG4vLyBEZWxldGUgbW9kYWwgY2xvc2VcbmNsb3NlRGVsZXRlTW9kYWwuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChkZWxldGVNb2RhbCkpO1xufSk7XG5cbi8vRXNjYXBlIEtldCBDbG9zZVxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2dCkgPT4ge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNvbnN0IG9wZW5Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfaXMtb3BlbmVkXCIpO1xuICAgIGlmIChvcGVuTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwob3Blbk1vZGFsKTtcbiAgICB9XG4gIH1cbn0pO1xuXG5jb25zdCBvdXRzaWRlQ2xpY2tDbG9zZSA9IChuYW1lZE1vZGFsKSA9PiB7XG4gIG5hbWVkTW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldnQpIHtcbiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gbmFtZWRNb2RhbCkge1xuICAgICAgY2xvc2VNb2RhbChuYW1lZE1vZGFsKTtcbiAgICB9XG4gIH0pO1xufTtcblxub3V0c2lkZUNsaWNrQ2xvc2UoZWRpdFByb2ZpbGVNb2RhbCk7XG5vdXRzaWRlQ2xpY2tDbG9zZShuZXdQb3N0TW9kYWwpO1xub3V0c2lkZUNsaWNrQ2xvc2UocHJldmlld01vZGFsKTtcbm91dHNpZGVDbGlja0Nsb3NlKGRlbGV0ZU1vZGFsKTtcbm91dHNpZGVDbGlja0Nsb3NlKGF2YXRhck1vZGFsKTtcblxuLy8gTG9hZGluZyB0ZXh0IG9uIGJ1dHRvblxuZnVuY3Rpb24gcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcsIGJ1dHRvbiwgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiKSB7XG4gIGlmIChpc0xvYWRpbmcpIHtcbiAgICBidXR0b24uZGF0YXNldC5vcmlnaW5hbFRleHQgPSBidXR0b24udGV4dENvbnRlbnQ7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBidXR0b24uZGF0YXNldC5vcmlnaW5hbFRleHQ7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cbn1cblxuLy9FZGl0IFByb2ZpbGVcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KGV2dCkge1xuICBjb25zdCBzdWJtaXRCdXR0b24gPSBldnQudGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3NhdmUtYnV0dG9uXCIpO1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICByZW5kZXJMb2FkaW5nKHRydWUsIHN1Ym1pdEJ1dHRvbik7XG5cbiAgYXBpXG4gICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICBuYW1lOiBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSxcbiAgICAgIGFib3V0OiBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuXG4gICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgc3VibWl0QnV0dG9uKTtcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICB9KTtcbiAgcmVzZXRWYWxpZGF0aW9uKGVkaXRQcm9maWxlRm9ybSwgW1xuICAgIGVkaXRQcm9maWxlTmFtZUlucHV0LFxuICAgIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCxcbiAgXSk7XG59XG5cbmVkaXRQcm9maWxlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KTtcblxuLy9BZGQgUGhvdG9zXG5mdW5jdGlvbiBoYW5kbGVQb3N0Rm9ybVN1Ym1pdChldnQpIHtcbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gZXZ0LnRhcmdldC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zYXZlLWJ1dHRvblwiKTtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24pO1xuXG4gIGFwaVxuICAgIC5wb3N0TmV3Q2FyZCh7XG4gICAgICBuYW1lOiBlZGl0UG9zdENhcHRpb25JbnB1dC52YWx1ZSxcbiAgICAgIGxpbms6IGVkaXRQb3N0UGhvdG9MaW5rLnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGNhcmQpID0+IHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZCk7XG4gICAgICBjYXJkc0xpc3QucHJlcGVuZChjYXJkRWxlbWVudCk7XG4gICAgICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICByZW5kZXJMb2FkaW5nKGZhbHNlLCBzdWJtaXRCdXR0b24pO1xuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgIH0pO1xufVxuXG5lZGl0UG9zdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQb3N0Rm9ybVN1Ym1pdCk7XG5cbi8vRWRpdCBhdmF0YXJcbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGV2dC50YXJnZXQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idXR0b25cIik7XG4gIHJlbmRlckxvYWRpbmcodHJ1ZSwgc3VibWl0QnV0dG9uKTtcblxuICBhcGlcbiAgICAuZWRpdEF2YXRhckltYWdlKHtcbiAgICAgIGF2YXRhcjogZWRpdEF2YXRhckxpbmsudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZUF2YXRhci5zcmMgPSBkYXRhLmF2YXRhcjtcbiAgICAgIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgc3VibWl0QnV0dG9uKTtcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICB9KTtcbn1cblxuZWRpdEF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJTdWJtaXQpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVyczsgLy8gY29uc3RydWN0b3IgYm9keVxuICB9XG5cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICBwb3N0TmV3Q2FyZCh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG5cbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRBdmF0YXJJbWFnZSh7IGF2YXRhciB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcblxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIHRvZ2dsZUxpa2UoeyBpZCwgaXNMaWtlZCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiY29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInNhdmVCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJtb2RhbEVycm9yQ2xhc3MiLCJtb2RhbEVycm9yVmlzaWJpbGl0eUNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImVycm9yRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRleHRDb250ZW50IiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50Iiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJhZGQiLCJkaXNhYmxlZCIsInJlc2V0VmFsaWRhdGlvbiIsImNmZyIsImZvckVhY2giLCJpbnB1dCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlbmFibGVWYWxpZGF0aW9uIiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsInBvc3ROZXdDYXJkIiwibmFtZSIsImxpbmsiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImRlbGV0ZUNhcmQiLCJlZGl0VXNlckluZm8iLCJhYm91dCIsImVkaXRBdmF0YXJJbWFnZSIsImF2YXRhciIsInRvZ2dsZUxpa2UiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzTGlzdCIsImNhcmRUZW1wbGF0ZSIsImVkaXRQcm9maWxlQnRuIiwiZWRpdFByb2ZpbGVNb2RhbCIsImNsb3NlUHJvZmlsZU1vZGFsIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJlZGl0UHJvZmlsZUZvcm0iLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsInByb2ZpbGVBdmF0YXIiLCJlZGl0QXZhdGFyQnV0dG9uIiwiYXZhdGFyTW9kYWwiLCJjbG9zZUF2YXRhck1vZGFsIiwiZWRpdEF2YXRhckZvcm0iLCJlZGl0QXZhdGFyTGluayIsIm5ld1Bvc3RCdG4iLCJuZXdQb3N0TW9kYWwiLCJjbG9zZVBvc3RNb2RhbCIsImVkaXRQb3N0Rm9ybSIsImVkaXRQb3N0UGhvdG9MaW5rIiwiZWRpdFBvc3RDYXB0aW9uSW5wdXQiLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3TW9kYWxUZXh0IiwicHJldmlld01vZGFsSW1hZ2UiLCJjbG9zZVByZXZpZXdNb2RhbCIsImRlbGV0ZU1vZGFsIiwiY2xvc2VEZWxldGVNb2RhbCIsImRlbGV0ZUJ1dHRvbiIsInNlbGVjdGVkQ2FyZCIsInNlbGVjdGVkQ2FyZElkIiwiZ2V0Q2FyZEVsZW1lbnQiLCJkYXRhIiwiY2FyZEVsZW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZE5hbWUiLCJjYXJkSW1hZ2UiLCJjYXJkTGlrZUJ1dHRvbiIsImNhcmREZWxldGVCdXR0b24iLCJzcmMiLCJhbHQiLCJldnQiLCJsaWtlQnV0dG9uIiwidGFyZ2V0IiwiY29udGFpbnMiLCJ0b2dnbGUiLCJjYXRjaCIsImNvbnNvbGUiLCJlcnJvciIsImhhbmRsZUxpa2UiLCJfaWQiLCJvcGVuTW9kYWwiLCJoYW5kbGVEZWxldGVDYXJkIiwiY2xvc2VzdCIsIm1vZGFsIiwiZm9jdXMiLCJjbG9zZU1vZGFsIiwiY2FyZHMiLCJ1c2VySW5mbyIsImNhcmQiLCJwcmVwZW5kIiwibG9nIiwicmVuZGVyTG9hZGluZyIsImZpbmFsbHkiLCJidXR0b24iLCJvbk9wZW4iLCJ2YWx1ZSIsImtleSIsIm91dHNpZGVDbGlja0Nsb3NlIiwibmFtZWRNb2RhbCIsImlzTG9hZGluZyIsImxvYWRpbmdUZXh0IiwiZGF0YXNldCIsIm9yaWdpbmFsVGV4dCIsInN1Ym1pdEJ1dHRvbiIsInByZXZlbnREZWZhdWx0IiwicmVzZXQiXSwic291cmNlUm9vdCI6IiJ9